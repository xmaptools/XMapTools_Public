<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<style>
body {background-color: transparent;}
th, td {vertical-align: top;}
a    {color: blue;}
p.ex {color: red;}
h2,h3,h4,h5 {margin-top: 2em; }
</style>
<TITLE>Help XMapTools</TITLE>
</HEAD>

<BODY>
<h1> Help > Tabs > Classify </h1>    	
<p><i>Help file version 16.09.2021 by M. Tedeschi & P. Lanari</i></p>
<p><a href="https://resources.xmaptools.ch" target="_blank">Access XMapTools resources online</a></p>
<p class="ex">This part of XMapTools 4 is currently at <b>level 3</b> of development (<i>1, largely untested; 2, tested for a few cases; 3, tested and benchmarked; 4, publication quality</i>). </p> 
<hr>
<p><b>Table of content</b><br \><br \>
<a href="#step1">Step 1 – Training Set</a><br \>
<a href="#step2">Step 2 – Classification Parameters (chemical system, algorithm, etc.)</a><br \>
<a href="#step3">Step 3 – Training a Classifier and Classification</a><br \>
<a href="#add1">Additional tools: filtering options</a><br \>
<a href="#add2">Additional tools: mask analysis & visualisation</a>
</p>
<hr>

<p>This help file contains a description of the tools available in the section <i>Classify</i>.

<p>The classification of compositional maps is the process of categorizing and labeling groups of pixels within a dataset based on their compositions. 
It generates a mask image showing the distribution of each mask/class (i.e. features can be mineral/epoxy/glass, etc., e.g. Fig. 1).
The methods implemented in XMapTools consist of supervised machine learning algorithms and require training data for a given number of masks (number of features). 
A training set is an ensemble of definitions containing a selection of pixels made using region-of-interest for each mask. 
A classification is divided into four distinct stages: </p>
<ul>
  <li>(1) Creation of a training set containing a selection of pixels for each mask</li>
  <li>(2) Definition of the chemical system, classification options and the choice of the algorithm</li>
  <li>(3) The computation of the classification</li>
  <li>(4) The evaluation of the results and visualisation of the final mask image (Fig. 1)</li>
</ul>

<img src="./img/Classification_MaskImage.png" width="700">
<i><b>Figure 1</b>: example of mask image for a metapelite from Himalaya published in Lanari & Duesterhoeft (2019). Each feature, here a mineral, is shown with a color. 
note that all the pixels of this image have been classified.</i> 


<h2><a name="step1"></a>Step 1 – Training Set</h2> 
<p>Use these tools to identify the phases, select compositions and create masks to be used in the classification.</p>
<p>To activate these functions the <i>Training Sets (Classification)</i> must be selected in the main menu on the left side.</p>

<h3>How to use the button <i>Add (Add training set/Phase definition/ROI)</i>? </h3> 

<img src="./img/icon_add.png" width="30"> The button <i>Add</i>  has several functionalities depending on the item selected in the secondary menu:
<ul>
  <li>Add a <i>training set</i> if the main node <i>Training Sets (Classification)</i> is selected</li>
  <li>Add a <i>phase definition</i> if a <i>training set</i> is selected</li>
  <li>Add a <i>region-of-interest</i> (ROI) if a <i>phase defintion</i> is selected</li>
</ul>

<h4>(1.1) Add a training set</h4>

<p>Select an intensity map in the primary menu and click on the item <i>Training Sets (Classification)</i> in the secondary menu. 
Pressing the button <img src="./img/icon_add.png" width="12"> adds a new training set <i>PhaseDef_1</i> and select it. 
This means that pressing again <img src="./img/icon_add.png" width="12"> would add a phase (see below).</p> 

<p>Note that the name of a training set can be edited in the text field (right of the <i>Add</i> button in the training set section) before pressing <img src="./img/icon_add.png" width="12"> or in the secondary menu by double-clicking on the name.</p>

<h4>(1.2) Add a phase</h4>

<p>Select a training set in the secondary menu and press the button <img src="./img/icon_add.png" width="12"> to add a new phase (e.g. <i>Phase 1</i>)</p>

<p>Note that the phase name can be edited in the text field (right of the <i>Add</i> button in the training set section) before pressing <img src="./img/icon_add.png" width="12"> or in the secondary menu by double-clicking on the name.</p>

<h4>(1.3) Add a ROI (region of interest)</h4>

<p>Select a phase the secondary menu and select the ROI shape in the dropdown menu right to the <i>Add</i> button. 
Press the button <img src="./img/icon_add.png" width="12"> to add a new ROI and select an area-of-interest by clicking on the image.
Successive selections of ROI with various shapes can be added to the same phase by clicking again the button <img src="./img/icon_add.png" width="12"></p>

<h3>Dropdown menu ROI shapes </h3> 

The following shapes are available to define a region of interest: 
<ul>
  <li><b>Rectangle:</b> click to select the first corner and drag the mouse to the opposite corner defining a rectangle</li>
  <li><b>Polygon:</b> click successively on the image to draw a polygon; right-clicking validates and closes automatically the shape</li>
  <li><b>Ellipse:</b> click to select the first point and drag the mouse to a second point defining the long axis of an ellipse</li>
  <li><b>Circle:</b> click to select the first corner of a square and drag the mouse to opposite corner defining a circle</li>
</ul>


<h2><a name="step2"></a>Step 2 – Classification Parameters (chemical system, algorithm, etc.) </h2>

<p>These tools are used to select an algorithm and maps to be used for classification.</p>


<h3>(2.1) Chemical system: how to add/remove maps?</h3>

<p>The goal is to set the map input of the classification function. It is not required to use all available maps for classification; 
maps containing only noise are usually excluded.</p>

<p>
<img src="./img/SS_Classification_FieldMap.png" height="30"> The list of map used by the classification function is displayed in this text field.</p>

<p>
<img src="./img/icon_add_sq.png" width="30"> The button <i>Add Maps for Classification</i> adds all maps available in the intensity tab of the primary menu.
</p>

<p>
<img src="./img/icon_add_round.png" width="30"> / <img src="./img/icon_minus_round.png" width="30"> The interchangeable button <i>Edit Selected Map</i> can have to mode: add (plus icon) or eliminate (minus icon)
depending if the map selected in the primary menu is already available in the list or not. 
Clicking the <img src="./img/icon_add_round.png" width="12"> button adds the selected map, whereas clicking the <img src="./img/icon_minus_round.png" width="12"> button eliminate the selected map from the list. 
</p>


<h3>(2.2) Algorithm selection: </h3>

<p>
<img src="./img/SS_Classification_Algorithm.png" height="30"> The machine learning algorithm used for classification can be selected via the <i>algorithm menu</i> available in section classification parameters.</p>

<p>Classification algorithms will be described in a publication soon (Lanari & Tedeschi in prep); a short summary is provided below:</p> 

<ul>
  <li><b>Random Forest:</b> An ensemble learning method for classification constructing a multitude of decision trees during training. The output of the random forest is the class selected by most trees (it is a majority vote!). The maximum number of tree can be set in the option field below the dropdown menu (default 75).</li>
  <li><b>Discriminant Analysis:</b> Classification method that assumes that different classes generate data based on different Gaussian distributions. To train a classifier, it estimates the parameters of a Gaussian distribution for each class. </li>
  <li><b>Naive Bayes:</b> Classification algorithm applying density estimation to the data and generating a probability model.  Then decision rule is based on the Bayes theorem.</li>
  <li><b>Support Vector Machine:</b> Data points (p-dimensional vector) are separated into n classes by separating them with a (p-1)-dimensional hyperplane. The algorithm chooses the hyperplane so that the distance from it to the nearest data point on each side is maximised. </li>
  <li><b>Classification Tree:</b> A decision tree is used as predictive model to classify the input features into classes via a series of decision nodes. Each leaf of the tree is labelled with a class.</li>
  <li><b>k-Nearest Neighbour:</b> An object is classified by a plurality vote of its neighbours, with the object being assigned to the class most common among its k nearest neighbours.</li>
  <li><b>k-Means:</b> Classification method that aims to partition n observations into k clusters in which each observation belongs to the cluster with the nearest cluster centroid, serving as a prototype of the cluster.</li>
</ul>


<h3>(2.3) Principal component analysis (PCA) – Optional </h3>

<p>
The principal components of a collection of points in a real coordinate space are a sequence of vectors consisting of best-fitting lines, each of them defined as one that minimizes the average squared distance from the points to the line. 
These directions constitute an orthonormal basis in which different individual dimensions of the data are linearly uncorrelated. The first principal component can equivalently be defined as a direction that maximizes the variance of the projected data.
Principal component analysis (PCA) is the process of computing the principal components and using them to perform a change of basis on the data.
</p>

<p>
<img src="./img/icon_picture.png" width="30"> The button <i>Generate Maps of the Principal Components (PCA)</i> a map for each principal component is generated and stored in the section <i>Other</i> of the primary menu.
</p>

<p>Three distinct PCA are performed:</p>
<ul>
  <li><b>PCA-1:</b> applied to the original map data</li>
  <li><b>PCA-2:</b> applied to rescaled range of data in the interval [0,1]</li>
  <li><b>PCA-3:</b> applied to normalised data following: Data2 = (Data - mean(Data)) / (std(Data)); </li>
</ul>

<p>Note that in the classification, PCA-2 and PCA-3 are both applied when the option PCA2 is selected.</p>

<h3>(2.4) Selection of input data and other options </h3>

<center><img src="./img/SS_Classification_includePCA.png" height="80"> </center>

<h4>Input data</h4>

The following data can be selected as input data for the classification function: 
<ul>
  <li><b>Maps:</b> Original data scaled using the method selected in the dropdown menu <i>Map Scaling</i> (see below)</li>
  <li><b>PCA-1:</b> first PCA dataset (see above)</li>
  <li><b>PCA-2:</b> second and third PCA datasets (PCA-2 and PCA-3 see above)</li>
  <li><b>TEXF:</b> textural information (undocumented) </li>
</ul>

<p>Example: if 8 intensity maps are considered, an total of 7 maps will be added if PCA-1 is selected and an additional 14 maps if PCA-2 is selected. </p>

<h4>Map scaling</h4>

The following options are available for data scaling: 
<ul>
  <li><b>Robust:</b> DataScaled = (Data - median(Data)) / iqr(Data); with iqr the interquartile range of the values</li>
  <li><b>MinMax:</b> Rescaled data in the range [0,1]</li>
  <li><b>Mean:</b> DataScaled = Data / mean(Data);</li>
  <li><b>NoScaling:</b> Original data</li>
</ul>

<h4>Reproducibility</h4>

<p>If selected, the option <i>Reprod.<i> controls the random number generator to ensure that results obtained using an algorithm with a random component (e.g. Random Forest) are reproducible for the seed value given in the text field. If the option is unselected, any classification using the Random Forest algorithm will converge to a slightly different result. The same result is obtained by changing the seed value.</p>


<h2><a name="step3"></a>Step 3 – Training a Classifier and Classification</h2>

<p>A <u>training set must be selected in the secondary menu</u> in order to activate the classification button.</p>

<p>
<img src="./img/icon_classify.png" width="30"> The button <i>Classify ( Train a Classifier & Classify)</i> trains a new classifier and performs the classification using the algorithm selected in the menu and the specified set of maps. 
</p>

<p>
Once the classification is achieved, a new mask file is generated and stored under <i> Masi files</i> in the secondary menu. 
The mask file is automatically selected and the mask image displayed in the main figure. 
</p>


<h2><a name="add1"></a>Additional tools: filtering options</h2>

The following options apply to a given mask file. Select a mask file in the secondary menu to apply changes.

<p>
<img src="./img/SS_Classification_Filter.png" height="25"> Select this option to hide pixels having a class probability lower than a given threshold (see below) for the selected mask file. 
</p>

<p>
<img src="./img/SS_Classification_ProbLimit.png" height="30"> Set the probability threshold used for hiding pixels (see above). This value should range between 0 and 1.
</p>

<p>
<img src="./img/icon_create.png" width="30"> The button <i>Create new mask file with pixels filtered by probability (all pixels below threshold)</i> generate a new mask file after filtering. 
This option replaces the BCR correction available in XMapTools 3 and is more adequate as only the miss-classified pixels are excluded.
</p>


<h2><a name="add2"></a>Additional tools: mask analysis & visualisation</h2>

<p>
The modes of each class within a given region-of-interest can be exported using the tools provided in this section. Modes are given as surface percentage calculated using the number of pixels of each class. 
For minerals, it can be eventually extrapolated to volume fraction as discussed in Lanari & Engi (2017). 
</p>

<p>
<img src="./img/SS_Classification_ROImodes.png" height="30"> Menu to select the ROI shape to be used to extract the local modes.
</p>

<p>
<img src="./img/icon_ROI.png" height="30"> The button <i>Add ROI</i> allows a new region-of-interest (ROI) to be drawn on the figure. Note that <u>a mask file must be selected before activating this mode</u>.
Results are displayed in the right window as a table containing the modes and number of pixel for each class and as a pie diagram. 
Note that the diagram can be saved using the plot options located at the top-right while the mouse pointer is over the plot. 
</p>

The following ROI shapes are available: 
<ul>
  <li><b>Rectangle:</b> click to select the first corner and drag the mouse to the opposite corner defining a rectangle</li>
  <li><b>Polygon:</b> click successively on the image to draw a polygon; right-clicking validates and closes automatically the shape</li>
  </ul>

<p>
<img src="./img/icon_plot.png" height="30"> The button <i>Plot Compositions</i> generates a plot using the data selected in the primary menu (either intensity, or a merged map) and the mask file selected in the secondary menu. An example is given in Figure 2.  
</p>

<img src="./img/Classification_CompPlot.png" width="700">
<i><b>Figure 2</b>: example of compositional plot generated using a merged map (expressed in oxide wt%) and the mask file shown in Fig. 1</i> 


<br \> <br \> <br \>
<br \> <br \> <br \>
<br \> <br \> <br \>
</BODY>
</HTML>














