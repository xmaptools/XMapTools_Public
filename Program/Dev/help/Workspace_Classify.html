<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<style>
body {background-color: transparent;}
th, td {vertical-align: top;}
a    {color: blue;}
p.ex {color: red;}
h2,h3,h4,h5 {margin-top: 2em; }
</style>
<TITLE>Help XMapTools</TITLE>
</HEAD>

<BODY>
<h1> Help > Workspace > Classify </h1>    	
<p><i>Help file version 10.01.2024 by M. Tedeschi & P. Lanari</i></p>
<hr>
<p><b>Table of content</b><br \><br \>
<a href="#step1">Step 1 – Training Set</a><br \>
<a href="#step2">Step 2 – Classification Parameters (chemical system, algorithm, etc.)</a><br \>
<a href="#step3">Step 3 – Apply Classification</a><br \>
<a href="#add1">Additional tools: filtering options</a><br \>
<a href="#add2">Additional tools: mask analysis & visualisation</a>
</p>
<hr>

<p>This help file contains a description of the tools available in the <i>Classify</i> section.</p>

<p>Compositional map classification is the process of categorising and labelling groups of pixels within a dataset based on their composition. 
It generates a mask image showing the distribution of each mask/class (i.e. features can be mineral/epoxy/glass, etc., e.g. Fig. 1).
The methods implemented in XMapTools consist of supervised machine learning algorithms and require training data for a given number of masks (number of features). 
A training set is an ensemble of definitions containing a selection of pixels made using regions of interest for each mask. 
A classification is divided into four different stages: </p>
<ul>
  <li>(1) Create a training set containing a selection of pixels for each mask</li>
  <li>(2) Definition of the chemical system, classification options and the choice of the algorithm</li>
  <li>(3) Calculate the classification</li>
  <li>(4) The evaluation of the results and visualisation of the final mask image (Fig. 1)</li>
</ul>

<center>
<img src="./img/Classification_MaskImage.png" width="800">

<p><i><b>Figure 1</b>: example of mask image for a metapelite from Himalaya published in Lanari & Duesterhoeft (2019). Each feature, here a mineral, is shown with a color. 
Note that all the pixels of this image have been classified.</i> </p>
</center>

<h2><a name="step1"></a>Step 1 – Training Set</h2> 
<p>Create a phase definition object containing the selected training compositions using these tools to identify the features to be classified.</p>

<p>To start classification and create a training set, select <i>Training Sets (Classification)</i> from the secondary tree menu.</p>

<h3>How to use the <i>Add (Add training set/Phase definition/ROI)</i> button? </h3> 

<img src="./img/icon_add.png" width="30"> The <i>Add</i> button has different functions depending on the item selected in the secondary tree menu:
<ul>
  <li>Add a <i>Training Set</i> when the <i>Training Sets (Classification)</i> item is selected</li>
  <li>Add a selection of <i>Phase Definition(s)</i> when a <i>Training Set</i> is selected</li>
  <li>Add a <i>Region Of Interest</i> (ROI) when a <i>Phase Defintion Object</i> is selected</li>
</ul>

<h4>(1.1) Add a training set</h4>

<p>Display an intensity map by selecting the corresponding element in the primary tree menu and selecting <i>Training Sets (Classification)</i> in the secondary tree menu. Press the <img src="./img/icon_add.png" width="12"> button to add a new training set <i>PhaseDef_1</i>. </p>

<p>Selecting the <i>Phase Assistant</i> option will display a Phase Assistant module with default mineral names (Fig. 2). Select the phase names and press the <i>Apply</i> button. <u>Note</u> that a database of mineral names is available in XMapTools. Changing the mineral name manually is possible, but will prevent automatic identification (e.g. for density values).</p>

<p>The name of a training set can be edited in the text box (to the right of the <i>Add</i> button in the training set section) before pressing <img src="./img/icon_add.png" width="12"> or in the secondary tree menu by double-clicking on the name.</p>

<center><img src="./img/Classification_Assistant.png" width="200"><br />
<p><i><b>Figure 2</b>: Phase Assistant with a selection of biotite, chlorite, garnet and muscovite.</i> </p></center>


<h4>(1.2) Add a new phase definition object</h4>

<p>Select a training set in the secondary tree menu and press the <img src="./img/icon_add.png" width="12"> button to add new phase definition(s). </p>

<p>If the <i>Phase Assistant</i> option is selected, a phase module containing default mineral names will be displayed (Fig. 2). Select the phase names and press the <i>Apply</i> button.</p>

<p>Note that the name of a phase definition object can be edited in the text box (right of the <i>Add</i> button in the training set section) before pressing <img src="./img/icon_add.png" width="12"> or in the secondary tree menu by double-clicking on the name. It is recommended to use the mineral names listed in the phase assistant to be compatible with the internal databases (e.g. for automatic definition of density values ).</p>

<h4>(1.3) Add a ROI (region of interest)</h4>

<p>Select a phase definition object from the secondary tree menu. Select a ROI shape from the drop down menu to the right of the <i>Add</i> button. Press the <img src="./img/icon_add.png" width="12"> button to add a new ROI and immediately select an area of interest by clicking on the image. </p>

<p>Multiple selections of ROIs with different shapes can be added to the same phase definition object by clicking again the <img src="./img/icon_add.png" width="12"> button again when a phase definition object is selected from the primary menu.</p>

<h3>Dropdown menu ROI shapes </h3> 

The following shapes are available to define a region of interest: 
<ul>
  <li><b>Rectangle:</b> click to select the first corner and drag the mouse to the opposite corner to define a rectangle</li>
  <li><b>Polygon:</b> click successively on the image to draw a polygon; right-click to validate and automatically close the shape</li>
  <li><b>Ellipse:</b> click to select the first point and drag to a second point to define the long axis of an ellipse</li>
  <li><b>Circle:</b> click to select the first corner of a square and drag to the opposite corner to define a circle</li>
</ul>


<h2><a name="step2"></a>Step 2 – Classification Parameters (chemical system, algorithm, etc.) </h2>

<p>These tools are used to select an algorithm and the map data to be used for classification.</p>


<h3>(2.1) Chemical system: how to add/remove maps?</h3>

<p>The aim is to create a list map to be used by the classification function. It is not necessary to use all available maps for classification; maps containing only noise are usually excluded. The detailed strategy will be described in a future paper (Lanari & Tedeschi, in prep). </p>

<p><img src="./img/SS_Classification_FieldMap.png" height="30"> The list of map used by the classification function is displayed in this text field.</p>

<p>
The <i>Add Maps for Classification</i> <img src="./img/icon_add_sq.png" width="30"> button adds all maps available in the selected data category from the primary tree menu.
</p>

<p>
The <i>Edit Selected Map</i> <img src="./img/icon_add_round.png" width="30"> / <img src="./img/icon_minus_round.png" width="30"> button has two modes: add (plus icon) or remove (minus icon), depending on whether or not the selected map is already listed in the primary tree menu. Clicking the <img src="./img/icon_add_round.png" width="12"> button adds the selected map, while clicking the <img src="./img/icon_minus_round.png" width="12"> button removes the selected map from the list. 
</p>

<h3>(2.2) Dataset selection</h3>

<p>It is possible to select several types of data to be used as input to the classification function. Note that for most algorithms, either the original data (maps) or the PCA data (PCA-M or PCA-N) must be selected. However, it is recommended to use maps + PCA-M + PCA-N for the random forest algorithm (Lanari & Tedeschi, in preparation).</p>

The following data types are available: 
<ul>
  <li><b>Maps:</b> Listed maps</li>
  <li><b>PCA-M:</b> Principal component maps obtained by PCA of the listed maps with a "mean" scaling. </li>
  <li><b>PCA-N:</b> Principal component maps obtained by PCA of the listed maps with a "normalisation" to the unit of variance. </li>
  <li><b>TEXTF:</b> Additional maps generated using computer vision tools. Details will be provided in a future publication.</li>
</ul>

<p>
The principal components of a collection of points in a real coordinate space are a sequence of vectors consisting of best-fitting lines, each defined as one that minimises the mean squared distance of the points to the line. 
These directions form an orthonormal basis in which different individual dimensions of the data are linearly uncorrelated. The first principal component can equivalently be defined as a direction that maximises the variance of the projected data.
Principal component analysis (PCA) is the process of calculating the principal components and using them to perform a change of basis on the data.
</p>

<p>
The <i>Generate Principal Component Maps (PCA)</i> <img src="./img/icon_picture.png" width="30"> button calculates a map for each Principal Component and stores it in the <i>Other</i> category of the primary tree menu.
</p>


<h3>(2.3) Other options</h3>

<p>Select a map scaling method from the Map Scaling drop-down menu. Several methods are available (Robust, MinMax, Mean and NoScaling). The Robust method is recommended for best results.</p>

The following options are available for data scaling: 
<ul>
  <li><b>Robust:</b> DataScaled = (Data - median(Data)) / iqr(Data); with iqr the interquartile range of the values</li>
  <li><b>MinMax:</b> Rescaled data in the range [0,1]</li>
  <li><b>Mean:</b> DataScaled = Data / mean(Data);</li>
  <li><b>NoScaling:</b> Original data</li>
</ul>


<p>If selected, the <i>Reprod.</i> option controls the random number generator to ensure that results obtained using an algorithm with a random component (e.g. Random Forest) are reproducible for the seed value given in the text box. If the option is not selected, any classification using the Random Forest algorithm will converge to a slightly different result. The same result can be obtained by changing the seed value.</p>


<h3>(2.4) Algorithm selection: </h3>

<p>
<img src="./img/SS_Classification_Algorithm.png" height="30"> The machine learning algorithm used for classification can be selected via the <i>algorithm menu</i>.</p>

<p>Classification algorithms will be described in a publication (Lanari & Tedeschi, in prep); a short summary is provided below:</p> 

<ul>
  <li><b>Random Forest:</b> An ensemble learning method for classification that constructs a large number of decision trees during training. The output of the random forest is the class selected by the most trees (it is a majority vote!). The maximum number of trees can be set in the option field below the drop-down menu (default 40).</li>
  <li><b>Discriminant Analysis:</b> Classification method that assumes that different classes produce data based on different Gaussian distributions. To train a classifier, it estimates the parameters of a Gaussian distribution are estimated for each class. </li>
  <li><b>Naive Bayes:</b> Classification algorithm that applies density estimation to the data and generates a probability model. The decision rule is then based on the Bayes theorem.</li>
  <li><b>Support Vector Machine:</b> Data points (p-dimensional vector) are divided into n classes by separating them with a (p-1)-dimensional hyperplane. The algorithm chooses the hyperplane so that the distance from it to the nearest data point on each side is maximised. </li>
  <li><b>Classification Tree:</b> A decision tree is used as a predictive model to classify the input features into classes via a series of decision nodes. Each leaf of the tree is labelled with a class.</li>
  <li><b>k-Nearest Neighbour:</b> An object is classified by a majority vote of its neighbours, with the object being assigned to the class most common among its k nearest neighbours.</li>
  <li><b>k-Means:</b> Classification method that aims to partition n observations into k clusters, where each observation belongs to the cluster with the nearest cluster centroid, which serves as the prototype of the cluster (e.g. Lanari et al. 2014).</li>
</ul>



<h2><a name="step3"></a>Step 3 – Training a Classifier and Classification</h2>

<p>A <u>training set must be selected in the secondary tree menu</u> in order to activate the Classify button.</p>

<p>The <i>Classify (Train a Classifier & Classify)</i> <img src="./img/icon_classify.png" width="30"> button trains a new classifier and performs the classification using the algorithm selected in the menu and the specified set of maps. </p>

<p> A new figure containing up to four plots will open and be continuously updated during classification (e.g. Fig 3 for classification with the Random Forest algorithm). Do not close this figure until the classification is complete, otherwise the plots will not be displayed. </p>

<center><img src="./img/Classification_PlotsRF.png" width="600"><br />
<p><i><b>Figure 3</b>: Plots for classification using the Random Forest algorithm. Top left: out-of-bag classification error vs. number of trees grown. The error value should be zero in most cases for a small number of trees. Top right: Predictor importance for the Random Forest classification. Cards with low predictor importance values can be eliminated without affecting the classification results. Bottom left: Confusion map of the training data set. Bottom right: Confusion plot of the test dataset. The numbers represent the number of data points. </i> </p></center>

<br /><br />

<p>
Once the classification is complete, a new mask file is generated and stored under <i> Mask Files</i> in the secondary tree menu. The mask file is automatically selected and the mask image is displayed. Selecting a mask file also allows information about the classification to be displayed in the Information window (Fig. 4).
</p>

<center><img src="./img/Classification_Information.png" width="200"><br />
<p><i><b>Figure 4</b>: Classification information displayed when a mask file is selected from the secondary tree menu (available in XMapTools 4.3 and later).</i> </p></center>




<h2><a name="add1"></a>Additional tools: filtering options</h2>

The following options apply to a given mask file. Select a mask file in the secondary tree menu to apply changes.

<p>
<img src="./img/SS_Classification_Filter.png" height="25"> Select this option to hide pixels having a class probability lower than a given threshold (see below) for the selected mask file. 
</p>

<p>
<img src="./img/SS_Classification_ProbLimit.png" height="30"> Set the probability threshold used for hiding pixels (see above). This value should range between 0 and 1.
</p>

<p>
<img src="./img/icon_create.png" width="30"> The button <i>Create new mask file with pixels filtered by probability (all pixels below threshold)</i> generate a new mask file after filtering. 
This option replaces the BCR correction available in XMapTools 3 and is more adequate as only the miss-classified pixels are excluded.
</p>


<h2><a name="add2"></a>Additional tools: mask analysis & visualisation</h2>

<p>
The modes of each class within a given region of interest can be exported using the tools provided in this section. Modes are given as surface fraction, calculated using the number of pixels of each class. For minerals, this can ultimately be extrapolated to volume percentage as discussed in Lanari & Engi (2017). 
</p>


<h3>Extract modes from a region of interest</h3>

<p>
<img src="./img/SS_Classification_ROImodes.png" height="30"> Menu to select the ROI shape to be used to extract the local modes.
</p>

<p>
The <i>Add ROI</i> button <img src="./img/icon_ROI.png" height="30"> allows a new region of interest (ROI) to be drawn on the figure. Note that <u>a mask file must be selected before activating this mode</u>.
The results are displayed in the right window as a table showing the modes and number of pixels for each class, and as a pie chart. 
Note that the plot can be saved using the plot options located in the top right hand corner while the mouse pointer is over the plot. 
</p>

The following ROI shapes are available: 
<ul>
  <li><b>Rectangle:</b> click to select the first corner and drag to the opposite corner to define a rectangle</li>.
  <li><b>Polygon:</b> click successively on the image to draw a polygon; right-clicking automatically validates and closes the shape</li>.
  </ul>
  
<h3>Extraction of pseudo modes using point counting method </h3>

<p>A point counting subroutine is included in XMapTools for training purposes. Note that it is not recommended to use this method to estimate modes, but rather to use all pixels (see above).</p> 

<p><img src="./img/Classification_PointCounting_Nb.jpg" height="30"> Set the number of unique points (with random positions) to be used for the point counting method.</p>

<p><img src="./img/Classification_PointCounting_MC.jpg" height="30"> Enable Monte Carlo simulation for point counting. When this option is selected, the point counting method is applied 1000 times to obtain a standard deviation (1-sigma) on the modes obtained. Note that the result obtained is equivalent to selecting N*1000 points.</p>

<p><img src="./img/icon_share2.png" height="30"> The <i>Calculate Pseudo Modes (Point Count)</i> button calculates pseudo modes using the point count method. N points, each with a unique set of coordinates, are generated and used to sample mask proportions and calculate pseudo modes.</p> 


<h3>Plot modes and composition </h3>

<p>
The <i>Plot Compositions</i> <img src="./img/icon_plot.png" height="30"> button generates a plot using the data selected in the primary tree menu (either intensity, or a merged map) and the mask file selected in the secondary tree menu. An example is shown in Figure 5.  
</p>

<center>
<img src="./img/Classification_CompPlot.png" width="550">
<p><i><b>Figure 5</b>: Example of compositional plot generated using a merged map (expressed in oxide wt%) and the mask file shown in Fig. 1</i> </p>
</center>

<br \> <br \> <br \>
<br \> <br \> <br \>
<br \> <br \> <br \>
</BODY>
</HTML>














