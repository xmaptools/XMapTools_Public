<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<style>
body {background-color: transparent;}
th, td {vertical-align: top;}
a    {color: blue;}
p.ex {color: red;}
h2,h3,h4,h5 {margin-top: 2em; }
</style>
<TITLE>Help XMapTools</TITLE>
</HEAD>

<BODY>
<h1> Help > Workspace > Classify </h1>    	
<p><i>Help file version 11.11.2022 by M. Tedeschi & P. Lanari</i></p>
<p><a href="https://resources.xmaptools.ch" target="_blank">Access XMapTools resources online</a></p>
<hr>
<p><b>Table of content</b><br \><br \>
<a href="#step1">Step 1 – Training Set</a><br \>
<a href="#step2">Step 2 – Classification Parameters (chemical system, algorithm, etc.)</a><br \>
<a href="#step3">Step 3 – Apply Classification</a><br \>
<a href="#add1">Additional tools: filtering options</a><br \>
<a href="#add2">Additional tools: mask analysis & visualisation</a>
</p>
<hr>

<p>This help file contains a description of the tools available in the section <i>Classify</i>.

<p>The classification of compositional maps is the process of categorizing and labeling groups of pixels within a dataset based on their compositions. 
It generates a mask image showing the distribution of each mask/class (i.e. features can be mineral/epoxy/glass, etc., e.g. Fig. 1).
The methods implemented in XMapTools consist of supervised machine learning algorithms and require training data for a given number of masks (number of features). 
A training set is an ensemble of definitions containing a selection of pixels made using region-of-interest for each mask. 
A classification is divided into four distinct stages: </p>
<ul>
  <li>(1) Creation of a training set containing a selection of pixels for each mask</li>
  <li>(2) Definition of the chemical system, classification options and the choice of the algorithm</li>
  <li>(3) The computation of the classification</li>
  <li>(4) The evaluation of the results and visualisation of the final mask image (Fig. 1)</li>
</ul>

<img src="./img/Classification_MaskImage.png" width="700">
<i><b>Figure 1</b>: example of mask image for a metapelite from Himalaya published in Lanari & Duesterhoeft (2019). Each feature, here a mineral, is shown with a color. 
Note that all the pixels of this image have been classified.</i> 


<h2><a name="step1"></a>Step 1 – Training Set</h2> 
<p>Use these tools to identify the features to be classified create a phase definition object containing the selected training compositions.</p>

<p>To start using these functionalities select the item <i>Training Sets (Classification)</i> available in the secondary tree menu.</p>

<h3>How to use the button <i>Add (Add training set/Phase definition/ROI)</i>? </h3> 

<img src="./img/icon_add.png" width="30"> The button <i>Add</i>  has several functionalities depending on the item selected in the secondary tree menu:
<ul>
  <li>Add a <i>training set</i> if the item <i>Training Sets (Classification)</i> is selected</li>
  <li>Add a selection of <i>phase definition(s)</i> if a <i>training set</i> is selected</li>
  <li>Add a <i>region-of-interest</i> (ROI) if a <i>phase defintion object</i> is selected</li>
</ul>

<h4>(1.1) Add a training set</h4>

<p>Display an intensity map by selecting the corresponding element in the primary tree menu and select the item <i>Training Sets (Classification)</i> in the secondary tree menu. Pressing the button <img src="./img/icon_add.png" width="12"> adds a new training set <i>PhaseDef_1</i>. 

<p>If the option <i>Phase Assistant</i> is selected, a phase assistant module containing default mineral names is displayed (Fig. 2). Select phase names and press the button <i>Apply</i>.</p>

<center><img src="./img/Classification_Assistant.png" width="200"><br />
<i><b>Figure 2</b>: Phase Assistant with a selection of biotite, chlorite, garnet and muscovite.</i> </center>

<p>Note that the name of a training set can be edited in the text field (right of the <i>Add</i> button in the training set section) before pressing <img src="./img/icon_add.png" width="12"> or in the secondary tree menu by double-clicking on the name.</p>

<h4>(1.2) Add a new phase definition object</h4>

<p>Select a training set in the secondary tree menu and press the button <img src="./img/icon_add.png" width="12"> to add new phase definition(s). </p>

<p>If the option <i>Phase Assistant</i> is selected, a phase Assistant Module containing default mineral names is displayed (Fig. 2). Select phase names and press the button <i>Apply</i>.</p>

<p>Note that the name of a phase definition object can be edited in the text field (right of the <i>Add</i> button in the training set section) before pressing <img src="./img/icon_add.png" width="12"> or in the secondary tree menu by double-clicking on the name. It is recommended to use the mineral names listed in the phase assistant to be compatible with the internal databases (e.g. for defining density values automatically).</p>

<h4>(1.3) Add a ROI (region of interest)</h4>

<p>Select a phase definition object in the secondary tree menu. Select a ROI shape in the dropdown menu right to the <i>Add</i> button. Press the button <img src="./img/icon_add.png" width="12"> to add a new ROI and immediately select an area-of-interest by clicking on the image. </p>

<p>Several selections of ROI with various shapes can be added to the same phase definition object by clicking again the button <img src="./img/icon_add.png" width="12"></p>

<h3>Dropdown menu ROI shapes </h3> 

The following shapes are available to define a region of interest: 
<ul>
  <li><b>Rectangle:</b> click to select the first corner and drag the mouse to the opposite corner defining a rectangle</li>
  <li><b>Polygon:</b> click successively on the image to draw a polygon; right-clicking validates and closes automatically the shape</li>
  <li><b>Ellipse:</b> click to select the first point and drag the mouse to a second point defining the long axis of an ellipse</li>
  <li><b>Circle:</b> click to select the first corner of a square and drag the mouse to opposite corner defining a circle</li>
</ul>


<h2><a name="step2"></a>Step 2 – Classification Parameters (chemical system, algorithm, etc.) </h2>

<p>These tools are used to select an algorithm and maps to be used for classification.</p>


<h3>(2.1) Chemical system: how to add/remove maps?</h3>

<p>The goal is to create a list map that will be used by the classification function. It is not required to use all available maps for classification; maps containing only noise are usually excluded.</p>

<p><img src="./img/SS_Classification_FieldMap.png" height="30"> The list of map used by the classification function is displayed in this text field.</p>

<p>
<img src="./img/icon_add_sq.png" width="30"> The button <i>Add Maps for Classification</i> adds all maps available in the intensity tab of the primary tree menu.
</p>

<p>
<img src="./img/icon_add_round.png" width="30"> / <img src="./img/icon_minus_round.png" width="30"> The interchangeable button <i>Edit Selected Map</i> can have two modes: add (plus icon) or eliminate (minus icon) depending if the selected map in the primary tree menu is already listed or not. Clicking the <img src="./img/icon_add_round.png" width="12"> button adds the selected map, whereas clicking the <img src="./img/icon_minus_round.png" width="12"> button eliminate the selected map from the list. 
</p>

<h3>(2.2) Dataset selection</h3>

<p>It is possible to select several type of data to be used as input by the classification function. Note that either the original data (Maps) or the PCA data (PCA-M or PCA-N) must be selected.</p>

The following types of data are available: 
<ul>
  <li><b>Maps:</b> Listed maps</li>
  <li><b>PCA-M:</b> Maps of principal components obtained by PCA of the listed maps with a "mean" scaling. </li>
  <li><b>PCA-N:</b> Maps of principal components obtained by PCA of the listed maps with a "normalisation" to the unit of variance. </li>
  <li><b>TEXTF:</b> Additional maps generated using computer vision tools. Details will be provided in a future publication.</li>
</ul>

<p>
The principal components of a collection of points in a real coordinate space are a sequence of vectors consisting of best-fitting lines, each of them defined as one that minimizes the average squared distance from the points to the line. 
These directions constitute an orthonormal basis in which different individual dimensions of the data are linearly uncorrelated. The first principal component can equivalently be defined as a direction that maximizes the variance of the projected data.
Principal component analysis (PCA) is the process of computing the principal components and using them to perform a change of basis on the data.
</p>

<p>
<img src="./img/icon_picture.png" width="30"> The button <i>Generate Maps of the Principal Components (PCA)</i> a map for each principal component is generated and stored in the section <i>Other</i> of the primary tree menu.
</p>


<h3>(2.3) Other options</h3>

<p>Select a map scaling method using the dropdown menu "Map Scaling". Several methods are available (Robust, MinMax, Mean and NoScaling). For optimal results, it is recommended to use the robust method.</p>

The following options are available for data scaling: 
<ul>
  <li><b>Robust:</b> DataScaled = (Data - median(Data)) / iqr(Data); with iqr the interquartile range of the values</li>
  <li><b>MinMax:</b> Rescaled data in the range [0,1]</li>
  <li><b>Mean:</b> DataScaled = Data / mean(Data);</li>
  <li><b>NoScaling:</b> Original data</li>
</ul>


<p>If selected, the option <i>Reprod.</i> controls the random number generator to ensure that results obtained using an algorithm with a random component (e.g. Random Forest) are reproducible for the seed value given in the text field. If the option is unselected, any classification using the Random Forest algorithm will converge to a slightly different result. The same result is obtained by changing the seed value.</p>


<h3>(2.4) Algorithm selection: </h3>

<p>
<img src="./img/SS_Classification_Algorithm.png" height="30"> The machine learning algorithm used for classification can be selected via the <i>algorithm menu</i>.</p>

<p>Classification algorithms will be described in a publication (Lanari & Tedeschi in prep); a short summary is provided below:</p> 

<ul>
  <li><b>Random Forest:</b> An ensemble learning method for classification constructing a multitude of decision trees during training. The output of the random forest is the class selected by most trees (it is a majority vote!). The maximum number of tree can be set in the option field below the dropdown menu (default 40).</li>
  <li><b>Discriminant Analysis:</b> Classification method that assumes that different classes generate data based on different Gaussian distributions. To train a classifier, it estimates the parameters of a Gaussian distribution for each class. </li>
  <li><b>Naive Bayes:</b> Classification algorithm applying density estimation to the data and generating a probability model.  Then decision rule is based on the Bayes theorem.</li>
  <li><b>Support Vector Machine:</b> Data points (p-dimensional vector) are separated into n classes by separating them with a (p-1)-dimensional hyperplane. The algorithm chooses the hyperplane so that the distance from it to the nearest data point on each side is maximised. </li>
  <li><b>Classification Tree:</b> A decision tree is used as predictive model to classify the input features into classes via a series of decision nodes. Each leaf of the tree is labelled with a class.</li>
  <li><b>k-Nearest Neighbour:</b> An object is classified by a plurality vote of its neighbours, with the object being assigned to the class most common among its k nearest neighbours.</li>
  <li><b>k-Means:</b> Classification method that aims to partition n observations into k clusters in which each observation belongs to the cluster with the nearest cluster centroid, serving as a prototype of the cluster.</li>
</ul>



<h2><a name="step3"></a>Step 3 – Training a Classifier and Classification</h2>

<p>A <u>training set must be selected in the secondary tree menu</u> in order to activate the classification button.</p>

<p><img src="./img/icon_classify.png" width="30"> The button <i>Classify ( Train a Classifier & Classify)</i> trains a new classifier and performs the classification using the algorithm selected in the menu and the specified set of maps. </p>

<p>
Once the classification is achieved, a new mask file is generated and stored under <i> Mask files</i> in the secondary tree menu. The mask file is automatically selected and the mask image displayed in the main figure. 
</p>


<h2><a name="add1"></a>Additional tools: filtering options</h2>

The following options apply to a given mask file. Select a mask file in the secondary tree menu to apply changes.

<p>
<img src="./img/SS_Classification_Filter.png" height="25"> Select this option to hide pixels having a class probability lower than a given threshold (see below) for the selected mask file. 
</p>

<p>
<img src="./img/SS_Classification_ProbLimit.png" height="30"> Set the probability threshold used for hiding pixels (see above). This value should range between 0 and 1.
</p>

<p>
<img src="./img/icon_create.png" width="30"> The button <i>Create new mask file with pixels filtered by probability (all pixels below threshold)</i> generate a new mask file after filtering. 
This option replaces the BCR correction available in XMapTools 3 and is more adequate as only the miss-classified pixels are excluded.
</p>


<h2><a name="add2"></a>Additional tools: mask analysis & visualisation</h2>

<p>
The modes of each class within a given region-of-interest can be exported using the tools provided in this section. Modes are given as surface percentage calculated using the number of pixels of each class. For minerals, it can be eventually extrapolated to volume fraction as discussed in Lanari & Engi (2017). 
</p>


<h3> Extracting modes from a region-of-interest </h3>

<p>
<img src="./img/SS_Classification_ROImodes.png" height="30"> Menu to select the ROI shape to be used to extract the local modes.
</p>

<p>
<img src="./img/icon_ROI.png" height="30"> The button <i>Add ROI</i> allows a new region-of-interest (ROI) to be drawn on the figure. Note that <u>a mask file must be selected before activating this mode</u>.
Results are displayed in the right window as a table containing the modes and number of pixel for each class and as a pie diagram. 
Note that the diagram can be saved using the plot options located at the top-right while the mouse pointer is over the plot. 
</p>

The following ROI shapes are available: 
<ul>
  <li><b>Rectangle:</b> click to select the first corner and drag the mouse to the opposite corner defining a rectangle</li>
  <li><b>Polygon:</b> click successively on the image to draw a polygon; right-clicking validates and closes automatically the shape</li>
  </ul>
  
<h3> Extracting pseudo-modes using point counting </h3>

<p> A subroutine of point counting is included in XMapTools for educational purposes. Note that it is not recommended to use this method to estimate modes, but to rather use all pixels (see above).</p> 

<p><img src="./img/Classification_PointCounting_Nb.jpg" height="30"> Set the number of unique points (with random positions) to be used for the point counting method.</p>

<p><img src="./img/Classification_PointCounting_MC.jpg" height="30"> Activate a Monte-Carlo simulation for point counting. If this option is selected the point counting method will be applied 1000 times to obtain a standard deviation (1-sigma) on the obtained modes. Note that the result obtained is equivalent to selecting N*1000 points.</p>

<p><img src="./img/icon_share2.png" height="30"> The button <i>Calculate pseudo-modes (point counting)</i> calculates pseudo-modes using the point counting method. N points with a unique set of coordinate each are generated and used to sample mask proportions and to calculate pseudo-modes.</p> 


<h3> Plotting modes and composition </h3>

<p>
<img src="./img/icon_plot.png" height="30"> The button <i>Plot Compositions</i> generates a plot using the data selected in the primary tree menu (either intensity, or a merged map) and the mask file selected in the secondary tree menu. An example is given in Figure 3.  
</p>

<img src="./img/Classification_CompPlot.png" width="700">
<i><b>Figure 3</b>: Example of compositional plot generated using a merged map (expressed in oxide wt%) and the mask file shown in Fig. 1</i> 


<br \> <br \> <br \>
<br \> <br \> <br \>
<br \> <br \> <br \>
</BODY>
</HTML>














