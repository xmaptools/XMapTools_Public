<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
   	<HEAD>
   	<style>
	body {background-color: transparent;}
	th, td {vertical-align: top;}
	a    {color: blue;}
	</style>
      <TITLE>Help Bingo-Antidote (XThermoTools)</TITLE>
   	</HEAD>

<BODY>
   	<br \>
   	<center>
   	<h1>DOCUMENTATION <br /> XThermoTools  &  Bingo-Antidote  </h1>
   	<br />
   	<i>Version 1.2.1 - PUBLIC - May 2019</i> <br \><br \>
   	<br \>
   	<img src="XTT_Dev/logo/logo_xtt_transparent.png" height="50px"></img><br \>
   	</center>
   	<br \> <br \>
   	<i>by Pierre Lanari (version 25.05.2020) </i>
   	<br \> <br \> <br \>

<table>
<tr>
	<td><h2>Table of content</h2></td>
	<td></td>
	<td></td>
</tr>
<tr>
	<td></td>
	<td><a href="#Information">Information</a> </td>
	<td><a href="#Notes">Release notes</a><br />
		<a href="#References">References & Citation</a><br />
	</td>
</tr>
<tr>
	<td></td>
	<td><a href="#Setup">Installation</a> </td>
	<td></td>
</tr>
<tr>
	<td></td>
	<td><a href="#Update">Update</a></td>
	<td></td>
</tr>
<tr>
	<td></td>
	<td><a href="#Step-by-step">How to get started?</a></td>
	<td><a href="#Step0">Step 0 - OptionsXTT.txt</a><br />
		<a href="#Step1">Step 1 - General settings</a><br />
		<a href="#Step2">Step 2 - Bulk</a><br />
		<a href="#Step3">Step 3 - Fluids, melts and buffers</a><br />
		<a href="#Step4">Step 4 - Phase definitions</a><br />
		<a href="#Tips">Additional tips</a><br />
	</td>
</tr>
<tr>
	<td></td>
	<td><a href="#Bingo">Bingo</a></td>
	<td><a href="#Bingo_results">Result section</a><br />
		<a href="#Bingo_resultsOptions">Manipulating results</a><br />
	</td>
	<td></td>
</tr>
<tr>
	<td></td>
	<td><a href="#Antidote">Antidote</a></td>
	<td><a href="#Antidote_Recipe1">Recipe 1 - Find optimal P-T(-X)</a><br />
	 	<a href="#Antidote_Recipe2">Recipe 2 - P-T map of Q factors</a><br />
		<a href="#Antidote_Recipe3">Recipe 3 - PT uncertainty</a><br />
		<a href="#Antidote_Recipe4">Recipe 4 - Find optimal P-T (Single Phase)</a><br />
		<a href="#Antidote_Recipe5">Recipe 5 - P-T map (Single Phase)</a><br />
		<a href="#Antidote_Recipe6">Recipe 6 - PT uncertainty (Single Phase)</a><br />
		<a href="#Antidote_Recipe7">Recipe 7 - Bulk sensitivity</a><br />
		<a href="#Antidote_Recipe8">Recipe 8 - P-T sensitivity</a><br />
		<a href="#Antidote_Recipe9">Recipe 9 - P-T-bulk sensitivity</a><br />
		<a href="#Antidote_Recipe10">Recipe 10 - Floating window (fixed P-T, variable bulk)</a><br />
		<a href="#Antidote_Recipe11">Recipe 11 - Scanning window (find optimal P-T, variable bulk)</a><br />
		<a href="#Antidote_Recipe12">Recipe 12 - Growing window (find optimal P-T, variable bulk)</a><br />
		<a href="#Antidote_Recipe13">Recipe 13 - Chemical potential mapping (fixed P-T)</a><br />
		<a href="#Antidote_Recipe14">Recipe 14 - Scanning H (fixed P-T)</a><br />
		<a href="#Antidote_Recipe15">Recipe 15 - Scanning C (fixed P-T)</a><br />
		<a href="#Antidote_Recipe16">Recipe 16 - Scanning O (fixed P-T)</a><br />
		</td>
</tr>
<tr>
	<td></td>
	<td><a href="#OptionsMinim">Options for optimisation</a></td>
	<td></td>
</tr>
</table>

<br \> <br \> <br \>

<p>XThermoTools 1.2.1 is the first PUBLIC version</p> 

<p>Please note that this software package is part of ongoing research developments:</p>
<ul>
  <li>Contact us if you edit the code or find any bug </li>
  <li>Contact us if you want to develop a new recipe </li>
</ul>


<p>A few warnings:</p>
<ul>
	<li>Use one of the version of Theriak-Domino provided in <i>/XTTPrograms/</i></li>
	<li>Use the databases provided with XThermoTools and the corresponding conversion files</li>
  	<li>Do no change the names of solution model in the database, or edit the conversion file and reopen XThermoTools</li>
  	<li>If a phase is not recognised, edit the conversion file and contact us that we can make the change before the next release is published</i>
  	<li>Oxygen buffers are not yet tested in Bingo-Antidote and they might have unexpected behaviour</li>
</ul>	



<br \> <br \> <br \>
<hr>
<a name="Information"></a> 
<h2>Information</h2>

<p>Bingo-Antidote provides a powerful alternative to traditional modelling tools and permits use of local bulk 
compositions for testing the assumption of local equilibrium in rocks that were not fully re-equilibrated 
during their metamorphic history.</p>

<p>Two versions are available:</p>
<ul>
  <li><i>Bingo-Antidote Standalone</i> working with Octave and MATLAB available at https://github.com/lanari/bingo-antidote</li>
  <li><i>Bingo-Antidote GUI</i> integrated in the XMapTools add-on XThermoTools requiring MATLAB</i></li>
</ul>

<p> This user-guide is designed for <i>Bingo-Antidote GUI</i>.


<br /><br />
<a name="Notes"></a> 
<h3>Release notes</h3>

The latest release notes are available <a href="About.txt" target="_blank">here</a> (this page opens in a new tab)


<br /><br />
<a name="References"></a> 
<h3>References & Citation</h3>

This modeling strategy and the program Bingo-Antidote are described in the following publications: 
<ul>
  <li>Duesterhoeft, E., & Lanari, P. (2020). Iterative thermodynamic modelling â€“ Part 1: A theoretical scoring technique and a computer program (BINGO-ANTIDOTE). <i>Journal of Metamorphic Geology</i>, DOI:10.1111/jmg.12538</li>
  <li>Lanari, P. & Duesterhoeft, E. (2019). Modelling metamorphic rocks using equilibrium thermodynamics and internally consistent databases: past achievements, problems and perspectives. <i>Journal of Petrology</i>, <b>60</b>, 19-56</li>
  <li>Lanari, P., & Engi, M. (2017). Local bulk composition effects on metamorphic mineral assemblages, <i>Reviews in Mineralogy and Geochemistry</i>, <b>83</b>, 55-102</li>
</ul>

Please use these references in your publications when you refer to Bingo-Antidote and specify the version of XThermoTools used to generate the data. 
Example: Iterative thermodynamic models based on compositional maps (Lanari & Engi, 2017; Lanari & Duesterhoeft 2019) were performed using Bingo-Antidote integrated in XThermoTools 1.2.1 (Duesterhoeft & Lanari 2020).





<br \> <br \> <br \>

<hr>
<a name="Setup"></a> 
<h2>XThermoTools installation</h2>

<ol>
	<li>Open MATLAB, Navigate in MATLAB to the working directory of your project and open XMapTools</li>
	<li>In menu, select <i>File > Add-Ons > Manage Extensions</i></li>
	<li>Find XThermoTools in the Extension manager</li>
	<li>Press the button <i>Download</i> (or <i>Delete & Download</i> to update the add-on)</li>
	<li>The add-on is downloaded and installed automatically</li>
  <li>Navigate to the workspace <i>QUANTI</i>. Note that XThermoTools requires the following data:</li>
  		<ul>
  			<li>Compositional maps containing pixel compositions expressed in weight-percentage of oxides. This dataset can be generated using the <i>Merge</i> functionality available in the workspace <i>Quanti</i>. Quantitative maps with different formats can be converted using the standardisation option <i>Transfer to Quanti</i></li>
  			<li>The corresponding mask file selected in the menu <i>Mask File</i> located in the left panel</li>
  			<li>A density map generated for the selected maskfile in <i>Quanti</i></li>
  		</ul>
  <li>Select <i>XThermoTools</i> in the add-on menu of XMapTools and press <i>OPEN</i></li>
  <li>Install the add-on by selecting the path of Theriak-Domino which is used by XThermoTools to perform Gibbs energy minimizations. It is strongly recommended to use the versions of the following versions of Theriak-Domino provided along with the XThermoTools package:</li>
  		<ul>
  			<li><u>Path for macOS</u>: <i>/XThermoTools/XTT_Programs/TheriakDominoMAC/</i> (Note: this version is compiled with <i>gfortran</i> - can be recompiled)</li>
  			<li><u>Path for WINDOWS</u>: <i>/XThermoTools/XTT_Programs/TheriakDominoWIN/</i> (Note: this version is compiled with <i>Cygwin</i> - DO NOT recompile using <i>MinGW</i>) The required dll files are available at https://www.xmaptools.com/xthermotools_box/Cygwindll4Theriak.zip</li>
  		</ul>
  <li>XThermoTools and Bingo-Antidote are ready!</li>
  
</ol>

<br \> <br \> 



<hr>
<a name="Update"></a> 
<h2>Updating XThermoTools</h2>

<h3>Program</h3>

The updates of XThermoTools are mandatory and cannot be skipped when a new version becomes available online. 
The update procedure is:
<ol>
  <li>Open XThermoTools from XMapTools (Internet connection required)</li>
  <li>Select <i>Update</i></li>
  <li>Re-open XThermoTools and install the add-on by selecting the path of Theriak-Domino (see <a href="#Setup">Installation</a>)</i></li>
</ol> 

<p><u>Note</u>: The version of Theriak-Domino provided in the XThermoTools package is updated along with the add-on. If you want to
re-compile Theriak-Domino on your machine, this needs to be done after every update. </p>


<h3>Databases and conversion files</h3>

<p>You can update the databases and defintion files via the menu <i>File</i> and <i>Database: update</i>. Note that this
option is only available when an update is available. </p>

<br \> <br \>




<hr>
<a name="Step-by-step"></a> 
<h2>How to get started?</h2>

<p>Follow this step-by-step description to get started with a new project. 
The requirements and procedure to send data from XMapTools is given above (see <a href="#Setup">Installation</a>).</p> 


<br />
<a name="Step0"></a>
<h3>Step 0: (optional) Generating OptionsXTT.txt</h3>

<p>It is judicious to set first a few project-specific parameters that will be saved in a file
<i>OptionsXTT.txt</i>. This file is automatically generated and saved in the working directory.
<u>Note</u>: while this file can be opened with any text editor, it is not recommended to manually
edit the content of this file.</p>

<p>In the menu <i>Initialize</i>, select the option <i>Generate OptionsXTT.txt</i>. A window opens in which 
the parameters stored in <i>OptionsXTT.txt</i> can be edited. Edit the parameters and press 
<i>Generate Option XTT</i> to validate and save the new settings. This module reads the file while
opening and automatically update the file while closing. If this module is closed without using
the button <i>Generate Option XTT</i>, the settings are not saved. </p>  

List of parameters that can be defined: 
<ol>
  <li>Bulk composition options 
  		<ul>
  			<li>Optional values of H and O in the bulk (THERIN format). Default: |H(1)O(?)O(0)|</li>
  			<li>Optional commands to be added after the bulk in THERIN. <u>Note</u>: This block must contain 
  			at least a star (*) and an empty space. Default: |* |</li>
  		</ul></li>
  <li>Default P-T conditions for Bingo 
  		<ul>
  			<li>Temperature (in degree Celsius)</li>
  			<li>Pressure (in bar)</li>
  		</ul></li>
  <li>P-T window for Antidote - There will be no optimisation or search outside this range
  		<ul>
  			<li>Minimum Temperature (degree C) | Temperature step (degree C) | Maximum temperature (degree C)</li>
  			<li>Minimum Pressure (bar) | Pressure step (bar) | Maximum Pressure (bar)</li>
  		</ul></li>
  <li>Default parameters for Antidote
  		<ul>
  			<li><i>Nb Perm.</i> is the number of simulations used for Monte-Carlo (MC) analysis; This parameters is also used for other optimisations based on random search.</li>
  			<li><i>dX</i> sensitivity parameter (in pixels) applied to move randomly each corner of a shape for MC analysis; uniform distribution</li>
  			<li><i>dT</i> sensitivity parameter (in degree C) applied to T for MC analysis; 1 sigma normal distribution</li>
  			<li><i>dP</i> sensitivity parameter (in degree P) applied to P for MC analysis; 1 sigma normal distribution</li>
  		</ul></li>
</ol>

<p>The button <i>Apply</i> allows the value in the field <i> Pressure step (bar)</i> to be set automatically that the number 
of steps in pressure will be equal to the number of steps in temperature.<p>



<br />
<a name="Step1"></a>
<h3>Step 1: General Settings (program / database / chemical system)</h3> 

<ul>
  <li>Select the program <i>Theriak</i> for performing Gibbs energy minimization</li>
  <li>Select a database (e.g. <i>JUN92.bs</i>). XThermoTools checks if the database exists in the working directory
  		and propose to make a new copy if the file is not available.</li> 
  <li>Press <i>Set</i> to define the chemical system. You can unselect/select elements in the new window. 
      <u>Note</u>: only the elements having a corresponding compositional map can be selected for modeling.
      This rule does not apply for H, C and O (see below).
      It IS NOT recommended to change the chemical system later on without reloading the bulk and phase definitions!</li>
</ul>

<p>These basic definitions are required for unlocking the next module</p>


<br />
<a name="Step2"></a>
<h3>Step 2: Defining a Bulk Composition</h3> 

<p> Here, the term <i>bulk composition</i> refers to any local bulk composition obtained from the compositional maps 
and used by Bingo or Antidote as input for Gibbs energy minimisation. </p>


<h4>Phase rejection:</h4>

<p> It is possible to reject phases from being used to determine a bulk composition. 
Press <i>Reject Phases</i> to select or unselect phases. The first menu lists all the phases 
available from the maskfile in XMapTools. If a phase is not used by Bingo-Antidote, a comment 
is added after its name: 
<ul>
  <li><i>## REJECTED ##</i> indicates that the composition of pixels belonging to this phase is not used to estimate the bulk composition</li> 
  <li><i>## Not available ##</i> indicates that the composition of the pixels belonging to this phase 
  		 was not provided while calling XThermoTools. This phase cannot be used, neither for determining 
  		 bulk composition, nor for comparison in Bingo. 
</ul>

<p> The number of phases available and selected is displayed next to the button <i>Reject Phases</i>.


<h4>Selecting, adding, deleting bulk compositions:</h4>

<p> Use the menu <i>Bulk</i> to manipulate bulk compositions: </p>
<ul>
	<li><i>Add Bulk</i> creates a new bulk composition from an user-defined domain: 
		click on the figure to select the domain - right-clicking on the figure validates the selection
		and generates the corresponding bulk that is displayed in the bulk field. A valid domain is defined
		with at least three points. </li>
	<li><i>Delete Bulk</i> deletes the selected bulk composition. This option is only available once a 
		bulk composition is defined.</li>
</ul>

XThermoTools can save and re-load existing bulk configurations for each project. Use the menu <i>Bulk</i> to: 
<ul>
	<li><i>Load Bulk Configuration</i> allows an existing configuration stored in the subdirectory <i>/Bingo/</i> 
		to be imported. This function check if a file <i>BIN_Bulk.xtt</i> exists. <u>Note</u>: This file is 
		project-specific and should not be used along with an other dataset as the domain selection will be different.
		The bulk compositions <b>are systematically re-calculated from the maps while loaded</b> 
		(and displayed in the MATLAB command window) as the chemical system may have changed. 
		The actual configuration of bulk composition can be saved using:</li>
	<li><i>Save Bulk Configuration</i> save the bulk compositions (and other options) in a file located in <i>/Bingo/</i>.
		The default file name is <i>BIN_Bulk.xtt</i>.</li>
</ul>
	
<p>The windows <i>Set Fluids, Melts & Buffers</i> opens if a new bulk is defined or if an existing bulk is loaded. This allows
the components H, C and O and their compositions to be defined. See step 3 below for a description of the options available in 
this module.</p>
	
<p>As soon as a valid bulk composition is defined, it unlocks the next module. However more than one bulk composition can 
be defined before going to step 4</p>


<a name="BulkFormat"></a>
<h4>Format used for bulk composition</h4>

<p>XThermoTools uses a very simple format for the bulk composition. For an element <i>i</i>, the bulk composition expressed 
in number of moles is calculated from the concentration in oxide weight-percentage (i.e. for 100 g of rock) using: </p>

<center><p><i>N_i = Oxi_i / MassOxi_i * NbElOxi</i> </p></center>

<p>with <i>N_i</i> the number of moles (in mol), <i>Oxi_i</i> the oxide concentration (in wt-%), 
<i>MassOxi_i</i> the molar weight of oxide (in g/mol) and <i>NbElOxi</i> the number of cations in the oxide component (no unit).</p> 


<br />
<a name="Step3"></a>
<h3>Step 3: Setting fluids melts and buffers</h3> 

<p>The components H, C and O cannot be extracted from the compositional maps and need to be defined via a special module. 
Note that this module automatically opens if a new bulk is defined or an existing bulk is loaded. It can also be opened via
the XThermoTools menu <i>Additional Elements</i> and <i>Set Fluids, Melts & Buffers</i>.</p>

<p>This module contains three blocks that are described in the following. Each block can be activated by selecting the 
option <i>Activate</i>.</p>

<p>Edit the parameters and press <i>Apply</i> to validate and apply these settings to the selected bulk composition.</p>

<h4>Fluid model (species H & C):</h4>

<p>Set the amount of H and C in the bulk and the corresponding species in the database. The following species are available
for each database as defined in the DEF files (e.g. XThermTools/XTT_Databases/DEF_JUN92.txt):</p>
<ul>
	<li>Fluid_H2O</li>
	<li>Fluid_CO2</li>
</ul>
<p>The corresponding equations of state are defined in the Theriak database. Other species will be added in a futur release. 
Please contact Pierre Lanari if you would like to include additional species.</p>

<p>The following <b>options</b> are available to set the composition of fluid species:</p>
<ul>
	<li>Set manually a <i>Fixed bulk (N)</i> value (see <a href="#Setup">bulk format</a>). 
	<br /><u>Example</u>: As the multiplication factor for <i>H2O</i> is <i>1/9</i> a value of H(0.11) corresponds to <i>1 wt%</i> of <i>H2O</i> 
	and H(0.011) to <i>0.1 wt%</i> of <i>H2O</i> provided that the sum of oxide is close to <i>100 %</i>.</li>
	<li>Select the option <i>Optimize N(fluid)</i> for optimising the amount of H in Antidote. 
	If the option is selected, the lower and upper limits for H values need to be set in the corresponding fields. 
	Note that the initial value used for example in Bingo is defined as: 
	<br />
	<center><i>N_lower - (N_upper-N_lower) / 2</i></center>
	</li>
</ul>

<p><u>Note</u>: this version of Bingo-Antidote requires the definition of a fluid model for H with a minimum 
concentration of 0.0001 mol. If you want to apply the model to anhydrous conditions, you need to manually edit the 
bulk in the bulk window of XThermoTools. In this case the bulk will be displayed in red. The minimum value of H 
will be restored if the module <i>Set Fluids, Melts & Buffers</i> is used.</p> 

<h4>Melt Model:</h4>

<p>Select this option to define the melt model to be used. The option <i>Inclide Melt in "solids" for evaluation</i> allows Bingo-Antidote
to consider the melt model as a solid and to calculate the volume fractions including solids + melt. By default Bingo-Antidote excludes
fluids and gases for calculating the volume fractions used for evaluation.</p>

<p>This option requires the definition of a melt model in the corresponding <i>DEF file</i></p>

<p>Note that the latest databases by Doug Tinkham automatically add the melt phase in the solids. 
In this case a Q<sub>cmp</sub> value of 100 % cannot be reached in the presence of a melt phase. </p> 

<h4>OXYGEN fugacity:</h4>

<p>There are two options to set the oxygen fugacity in Theriak-Domino. The first solution for controlling the oxygen fugacity
is by adding extra oxygen to the bulk. The definition is:</p> 
<center><i>O(?)O(N_extra)</i></center>
<p>with <i>O(?)</i> being used to calculate the number of moles of oxygen by stoichiometry and <i>O(N_extra)</i> to add an extra 
amount of <i>N_extra</i> mol of oxygen. The second one involves the application of an oxygen buffer.</p>

<p>Extra oxygen can be added via the module <i>Set Fluids, Melts & Buffers</i> in the third block entitled <i>OXYGEN fugacity</i>.
If this option is selected, a <i>Fixed bulk (O in mol)</i> amount can be manually defined. It will be added to the bulk using the method
described above. The amount of extra oxygen can also be part of the optimisation if the option <i>Optimise N(O)</i> is selected. 
In this case, the lower and upper limits for O values need to be set in the corresponding fields.

<p>The use of oxygen buffer is not available in this version of XThermoTools.</p> 


<br />
<a name="Step4"></a>
<h3>Step 4: Phase definition</h3>

<p>Each phase <u>to be included</u> in the computation of Q<sub>cmp</sub> must be matched 
with a phase or model in the database before to call Bingo. The synchronisation is only valid 
for a given database as the phase and solution model names can differ between the databases.</p> 

<h4>Phase matching and selection of the reference composition</h4>

Use the options in the menu <i>Phase Matching</i> to synchronize each phase to be considered for modeling and
define their reference compositions:

<ul>
  <li>Select a phase in the drop-down menu located below the item <i>Phase definitions</i></li>
  <li>In the menu <i>Phase Matching</i>, select <i>Synchronize [PhaseName]</i> for matching the selected phase with 
  a phase or model in the active database. A menu is displayed for manual selection if the phase is not recognised based
  on his name (check <a href="#Tips">Additional tips</a> if your phase is not listed)</li>
  <li>Once the matching is completing, the name of the solution model is displayed on the right of the 
  phase drop-down menu</li> 
  <li>Select a diagnostic element via the button <i>Element</i> and eventually adjust the phases 
  to be displayed in the map using the button <i>Sel. phases display</i></li> 
  <li>In the map, click and drag over an area of interest to zoom in. Note that the zoom will be inactive during the next step</li>
  <li>In the menu <i>Phase Matching</i>, select <i>Add group</i></li>
  <li>Select on the map a region-of-interest within the phase by selecting spots that define segments
  of a polygon and right click to validate the selection. The polygon is automatically closed without 
  considering the right clicking position. NOTE that clicking outside the map cancels the selection process
  and results in a warning: <i>Aborded... Do not click outside the map while selecting an area!</i></li> 
  <li>The average composition and standard deviation is displayed in the MATLAB command window</li>
  <li>[Optional] In the menu <i>Phase Matching</i>, select <i>Add group</i> for adding one more group of 
  composition for the selected phase.</li>
</ul>

<p>Repeat the procedure for all the phases to be modelled for the metamorphic stage being investigated.</p>

<p>Other options available in the menu <i>Phase Matching</i>:
<ul>
  <li><i>Desynchronize</i> for cancelling the matching for the selected phase and reseting the groups</li>
  <li><i>Manual Synchronization</i> for matching the phase from the manual selection menu (see above)</li>
  <li><i>Delete a group</i> for deleting the selected group of composition</li>
  <li><i>Load Phase Configuration</i> allows existing configuration stored in the subdirectory <i>/Bingo/</i> to be imported. If the file corresponding to the selected
  database does not exist, select an other configuration to be imported</li> 
  <li><i>Save Phase Configuration</i> save the phase configuration (and other options) in a file located in <i>/Bingo/</i>. Note that the
  database name in included in the file name</li>
</ul>
  
<p>Notes concerning the phases:</p>
<ul>
  <li>Phases that are not reactive must be excluded (see <a href="#Step2">Phase rejection</a>) - they do not participate to the reactive bulk composition!</li>
  <li>Phases assumed to represent a frozen equilibrium state - to be investigated - must be synchronized</li>
  <li>Retrograde phases are taken into consideration for the computation of the reactive bulk composition, but they do not need to be synchronized </li>
  <li>Note that Q<sub>asm</sub> cannot be 100 % if a phase of the investigated equilibrium was completly consumed during retrogression</li> 
</ul>


<h4>Validate the phase definition</h4>

<p>Once this is accomplished, select in the menu <i>Phase Matching</i> the option <b><i>Validate Phase Definitions</i></b>. 
The program calculates the relative proportion of each phase to be used for the calculation of Q<sub>vol</sub></p>

<p>This activates the programs <i>Bingo</i> and <i>Antidote</i></p>



<br />
<a name="Tips"></a>
<h3>Additional tips:</h3>
<ul>
  <li>DO NOT CHANGE THE WORKING DIRECTORY in MATLAB. The files such as the database and Classification.txt are located in the working directory and required by Bingo-Antidote</li>
  <li>PC users need to have the file theriak.ini in the working directory. Note that XThermoTools is supposed to handle that and make a copy of the file if required</li>
  <li>Do no change the model names in the database, event though they do not reflect the original names. Check the definition file to see what name Bingo-Antidote is expecting during the matching</li>
  <li>Check the definition file if your mineral is not available in Bingo-Antidote and contact Pierre Lanari (pierre.lanari@geo.unibe.ch) for updating the files</li>
  
</ul>



<br \> <br \> 
<hr>
<a name="Bingo"></a>
<h2>Bingo</h2>

<p>Once all the required steps are accomplished (database, bulk, fluid and solid definitions) the <i>Bingo</i> part of <i>XThermoTools</i> becomes 
available.</p>

<p>Set the temperature (unit: degree C) and pressure (unit: bar) of interest and press the button <i>BINGO</i></p>

<br />
<a name="Bingo_results"></a>
<h3>RESULT section (bingo)</h3>

<p><i>Bingo</i> generates results that are displayed in the result section (accessible via the <i>RESULTS</i> tab). Up to 10 results are kept in memory
and listed in the dropbox menu right to the button <i>RESULTS</i></p>

<p>The result section contains:</p> 
 <ul>
  <li><b>P-T diagram</b> showing the P-T conditions at which <i>Bingo</i> was called. </li>
  <li><b>Quality factors</b>: <i>Assemblage</i> for Q<sub>asm</sub>; <i>Modes</i> for Q<sub>vol</sub>; 
      <i>Compositions</i> for Q<sub>cmp</sub>; <i>Evaluation</i> for Q<sub>total</sub></li>
  <li><b>Report output (info)</b> containing the date, conditions and bulk used for obtaining the selected result</li>
  <li><b>Modes</b> via two pie diagrams showing the observed mineral modes (left) and modeled mineral modes (right). Note that the colors of the 
      two pie diagrams are always matching - a given phase will be displayed with the same color in both diagrams - but that this is not the case
      between two results. Press the button <i>Save</i> to save the results including the pie diagrams</li>
  <li><b>Composition table</b> for observations (left) and model (right). The two last columns are compositional variables which can be selected in the 
  two menus available below the left table</li>  
</ul>


<br />
<a name="Bingo_resultsOptions"></a>
<h3>Manipulating results</h3>

<p><b>Clear</b> (button). Delete all results in memory. Any result that is not saved will be lost</p>

<p><b>Save</b> (button). Save the selected results in the folder <i>/Bingo_Reports/</i>. Four files are saved:</p> 
<ul>
  <li><i>FileName.fig</i> contains the two pie diagrams MATLAB format - can be opened in MATLAB </li>
  <li><i>FileName.pdf</i> same figure PDF format - can be edited in Illustrator </li>
  <li><i>FileName.mat</i> MATLAB binaries file containing the structure <i>TheReport</i> used by <i>XThermoTools</i> for loading the result (the other files are not required for loading a report)</li>
  <li><i>FileName.xtt</i> is a text file containing a summary of the main results</li>
</ul>

<p><b>Load</b> (button). Load a result previously saved</p> 

<br \> <br \> 
<hr>
<a name="Antidote"></a>
<h2>Antidote</h2>

<p>Similarly to Bingo, the <i>Antidote</i> part of <i>XThermoTools</i> becomes 
available once all the required steps are accomplished (database, bulk, fluid and solid definitions).</p>

<p>Select a recipe in the drop-down menu, adjust the corresponding settings and press the button <i>ANTIDOTE</i></p>


<br />
<a name="Antidote_Recipe1"></a>
<h3>Recipe 1 - Find optimal P-T(-X)</h3>

<p>This routine can be used for PT optimisation only or for P-T-X optimisation if one of the option <i>Optimize N(fluid)</i> or 
<i>Optimize N(O)</i> is selected in <i>Set Fluids Melts and Buffers</i></p>

<h4>P-T optimisation</h4>

<p> The optimisation starts with the <b>Exploratory P-T scanning</b> (default 10 x 10). The objective function is mapped and the result displayed in the LIVE panel. 
The white star shows the P-T conditions with the lower value of <i>-Q<sub>total</sub></i>. The crosses show conditions at which the model is saturated with an aqueous fluid. 
Note that if Q<sub>asm</sub> is not 100 % (or the maximum value in the studied P-T space) there is a good chance that the next step of optimisation will converge to a local minimum. </p>  

<p> The mapping stage is followed by the <b>Final P-T Optimization</b> starting at the the P-T conditions with the lower value of <i>-Q<sub>total</sub></i>. 
The iterations are displayed in the MATLAB Command Window</p>   


<h4>P-T-X optimisation</h4>

<p>One of the option <i>Optimize N(fluid)</i> or <i>Optimize N(O)</i> is selected in <i>Set Fluids Melts and Buffers</i>. We DO NOT RECOMMEND using more than one variable at the time
with this version of Bingo-Antidote. The upper and lower limits should be fixed in a restricted range and centered on the expected value. For example if H(0.4) is expected and saturation
is at H(0.6), you can scan between 0.022 and 0.062. Do not optimise H in a range with saturated conditions as the objective function will be flat and the model will 
fail to converge. Several warnings related to this issue are reported in the MATLAB Command Window during optimisation.</p>

<p> The optimisation starts with the <b>Exploratory P-T scanning</b> (default 10 x 10) with a X value of <i>Xmin+(Xmax-Xmin)/2</i> 
A diagnostic is made and results are displayed in the Command Windows. The program detects the maximum value of Q<sub>asm</sub> and how many 
P-T couples are within this stability field (N) </p>

<p> The second step consist of the <i>Exploratory P-T-X scanning</i> during which a scan of X is applied to the N P-T couples previously detected. The 
P-T-X couple with the lower value of <i>-Q<sub>total</sub></i> is selected for the next step. </p>

<p> <i>Final P-T-X Optimization</i>. Note that this function will likely fail if the starting P-T-X is far away from the global minimum. In most instances, 
this function is to complex and irregular to be optimised without a stage of P-T-X exploratory scanning. </p>  


<br />
<a name="Antidote_Recipe2"></a>
<h3>Recipe 2 - P-T map of Q factors</h3>

<p>This recipe produces P-T maps of each quality factor including Q<sub>cmp</sub> of each phase as well as other quantities (e.g. volume fractions). The 
P-T window (and step) can be set using the tool <i>Generate OptionsXTT.txt</i>. Results are saved in <i>/Antidote/Recipe_2_[DATE_TIME]/</i>
</p> 


<br />
<a name="Antidote_Recipe3"></a>
<h3>Recipe 3 - PT uncertainty</h3>

<p>This recipe calculates the uncertainty enveloppe on the objective function for a given tolerance (in %) around the P-T conditions defined in Bingo.  
</p> 

<p>Refinement stages: </p>
<ul>
  <li><i>Auto-refinement</i> using the method method described in Lanari et al. (2017), European Journal of Mineralogy</li>
  <li><i>Monte-Carlo 1</i> random search around the points obtained at the previous step (<i>50 + 50*NbPoints</i> iterations; black + blue spots)</li>
  <li><i>Monte-Carlo 2</i> random search around the points obtained at the previous step (<i>15*NbCornersAfter_MC1</i> iterations; green spots)</li>
  <li><i>Monte-Carlo 3</i> random search around the points obtained at the previous step (<i>15*NbCornersAfter_MC2</i> iterations; red spots)</li>
</ul>


<br />
<a name="Antidote_Recipe4"></a>
<h3>Recipe 4 - Find optimal P-T (Single Phase)</h3>

<p>Perform a simple P-T optimisation of an objective function defined as -Q<sub>cmp</sub> of the selected phase using the two stage method described above for Recipe 1.
</p> 

<br />
<a name="Antidote_Recipe5"></a>
<h3>Recipe 5 - P-T map (Single Phase)</h3>

<p>Produce a P-T map of Q<sub>cmp</sub> for the selected phase. Note that recipe 2 also does this computation and is therefore recommended. 
</p> 

<br />
<a name="Antidote_Recipe6"></a>
<h3>Recipe 6 - PT uncertainty (Single Phase)</h3>

<p>Calculate the uncertainty enveloppe on the objective function for the selected phase for a given tolerance (in %) around the P-T conditions defined in Bingo.
</p> 

<br />
<a name="Antidote_Recipe7"></a>
<h3>Recipe 7 - Bulk sensitivity</h3>

<p>Perform a Monte-Carlo simulation at fixed P-T conditions defined in Bingo and variable bulk composition. Each corner of the domain will be randomly moved according to the number of 
pixels defined in <i>dPx</i> (1 sigma, normal distribution, default 40 for large maps, 5-10 for small maps) using: <i>NewCoor = CoorOri + randn(1)*dPx</i>. The bulk is recalculated at  every iteration and dispayed
in the MATLAB Command Window. Results are printed in the Command Window and the volume fractions of each phase plotted in histograms. 
The number of permutations is defined in <i>Perm.</i> (default 100).
</p> 

<br />
<a name="Antidote_Recipe8"></a>
<h3>Recipe 8 - P-T sensitivity</h3>

<p>Perform a Monte-Carlo simulation at variable P-T conditions and fixed bulk. The P-T conditions are randomly changed using the parameters
<i>dT</i> and <i>dP</i> (1 sigma, normal distribution, degree C and bar) using: <i>Tsimul = T+randn(1)*dT</i> and <i>Psimul = P+randn(1)*dP</i>. 
Results are printed in the Command Window and the volume fractions of each phase plotted in histograms.
The number of permutations is defined in <i>Perm.</i> (default 100).
</p> 

<br />
<a name="Antidote_Recipe9"></a>
<h3>Recipe 9 - P-T-bulk sensitivity</h3>

<p>This recipe combines recipes 7 and 8 (see above) and involves Monte-Carlo simulation at variable P-T and bulk.
</p> 

<br />
<a name="Antidote_Recipe10"></a>
<h3>Recipe 10 - Floating window (fixed P-T, variable bulk)</h3>

<p>Run <i>Bingo</i> at fixed P-T for a rectangular floating window moving along a path. The evolution of the Q factors as well as the modes and chemical potential
are plotted and the figure saved in <i>/Antidote/Antidote_Recipe20_[Date_Time]/</i></p> 

<p>Click on the map to: (1) select two points that defines a rectangular area; (2) several points defining a path along which the center of the rectangle will
be moving on. Right clicking validates the selection. (3) Define the number of computational steps for each segment (single value).</p>

<br />
<a name="Antidote_Recipe11"></a>
<h3>Recipe 11 - Scanning window (find optimal P-T, variable bulk)</h3>

<p>Divide the mapped area in <i>n</i> by <i>m</i> subdomains defined in the fields <i>x steps</i> and <i>y steps</i>. For each domain a simple P-T optimisation
(similar to Recipe 1) is applied. The size of each subdomain is calculated as: <i>x_wsize=2*floor(xLength/(x_stepsize+1))</i> and <i>y_wsize=2*floor(yLength/(y_stepsize+1));</i></p>

<p>The optimal P-T condition of each iteration is plotted in the P-T diagram (LIVE tab) and displayed in a table</p> 

<p>A file <i>SW_data_[DATE_TIME].txt</i> is saved in the working directory once the computation is completed. Note that this function can take some time depending on the number of
optimisations (defined as <i>n</i> x <i>m</i>) This file can be loaded when the recipe is selected by using the option <i>Load SW</i>. Selecting a row in the table
allows the optimal P-T and the domain to be plotted.</p>


<br />
<a name="Antidote_Recipe11"></a>
<h3>Recipe 12 - Growing window (find optimal P-T, variable bulk)</h3>

<p>Similar to Recipe 11, but in this case based on a growing window with <i>n</i> steps as defined in the field <i>steps</i>.</p>



<br />
<a name="Antidote_Recipe13"></a>
<h3>Recipe 13 - Chemical potential mapping (fixed P-T)</h3>

<p>This recipe is described in the appendix of Duesterhoeft & Lanari (2020). Additional description will be added in a future update.</p>


<br />
<a name="Antidote_Recipe14"></a>
<h3>Recipe 14 - Scanning H (fixed P-T)</h3>

<p>Evaluate the quality factors at fixed P-T and bulk conditions except for Hydrogen (H). The option <i>Optimize N(fluid)</i> should be selected in 
<i>Set Fluids Melts and Buffers</i>. A total of <i>NbSteps = 30</i> comparisons is performed between <i>min(H)</i> and <i>max(H)</i> using 
a regularly spaced array with a step of <i>(Max(H)-Min(H))/(NbSteps-1)</i> </p>

<p>Results are saved in <i>/Antidote/Recipe_2_[DATE_TIME]/</i> including a figure with the Q<sub>cmp</sub> of each phase, a figure with the Q factors and 
the model <i>vs</i> mineral modes.</p>

<p>An application example is discussed in Lanari & Duesterhoeft (2019).</p>


<br />
<a name="Antidote_Recipe15"></a>
<h3>Recipe 15 - Scanning C (fixed P-T)</h3>

<p>Same as recipe 14 but for Carbon (C).</p>

<br />
<a name="Antidote_Recipe16"></a>
<h3>Recipe 16 - Scanning O (fixed P-T)</h3>

<p>Same as recipe 14 but for extra Oxygen (O).</p>


<br \> <br \> <br \>
<br \> <br \> <br \>

<hr>
<a name="OptionsMinim"></a>
<h2>Additional options for the optimisation (Preferences)</h2>

<p>The optimisation settings can be adjusted via the menu <i>File</i> and <i>Preferences</i>. Adjust the settings and press <i>APPLY</i> to apply the settings and
close this window. The following options are available:</p> 

<ul>
	<li><i>TEST mode (Bingo-Antidote).</i> Note that this mode is available for developers and we do not recommend to normal 
		users to select this option. The output is considerably changed when this mode is selected. The test mode also store
		results in <i>Bingo_Test/</i> every time Bingo is called. Every new call of Bingo replaces all the files. Use the following 
		code to display information while the TEST mode is active: 
		<xmp> 
		load('MinimOptions.mat');
		if isequal(MinimOptions.TestMode,1)
			% display instructions or keyboard
		end
		</xmp>
		What happens if the option <i>TEST mode (Bingo-Antidote)</i> is selected? 
		<ul>
  			<li><b>Bingo</b>: The content of the folder <i>Bingo_Test</i> is updated at every Bingo's call. This folder contains all the input files (including the database) for Bingo-Antidote Standalone</li>
  			<li><b>Antidote Recipe 1 - PTX optimisation</b>: for the second step <i>Exploratory P-T-X scanning</i>, the limit of 50 P-T couples is removed and the scan in X goes up from 10 to 100; </li>
  		</ul></li>		
		</li><br />
	<li><i>Use Q<sub>total2</sub> (manual weights) </i>. Change the objective function used by <i>Antidote</i>. If you want to define manually the weights, enter the values in the corresponding 
	fields and press the button <i>Add & Select</i>. The button <i>Restore default</i> removes the additional weight definitions and restores the original configuration. Note that the additional 
	weights will not be preserved after updating XThermoTools! <br /><br />
	
	<li><i>Optimisation (menu)</i>. Select the optimisation strategy for minimising -Q<sub>total</sub>: <i>Symplex (fminsearch)</i>. <br /><br />
	
	<li><i>Optimisation from.</i> Select the starting P-T conditions for the PT-X optimisation in <i>Antidote</i>. 
		<ul>
  			<li><i>Preliminary P-T gridding with N steps.</i> Option for performing a PTX optimisation; this involves mapping the objective function in the P-T space first. 
  			The default number of steps is <i>10</i>, corresponding to a <i>10*10</i> grid. </li>
  			<li><i>From Bingo input</i> Optimisation will start at the P-T conditions of the <i>Bingo</i> input. Note that if this option is selected, 
  			only P and T will be optimised as this configuration does not guarantee that a global minimum was reached when compositional 
  			variables are involved. </li>
  		</ul></li><br />
  		
  	<li><i>P-T uncertainty</i> Options for recipes 2 and 5 (P-T uncertainty). 
		<ul>
  			<li><i>Nb. perm (step 1)</i> number of simulations used for Monte-Carlo (MC) analysis during step 1 (blue) - homogeneous distribution in the P-T stage</li>
  			<li><i>Nb. perm (step 2)</i> number of simulations used for Monte-Carlo (MC) analysis during step 2 (red & green) - distributed around the corners of the P-T shape </li>
  		</ul></li>
</ul>
	
	
	

<br \> <br \>


<center><img src="XTT_Dev/logo/logo_transparent.png" width="300px"></img></center


<br \> <br \> <br \>
<br \> <br \> <br \>

</BODY>

</HTML>














